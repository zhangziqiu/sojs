!function(){var t={name:"sojs",namespace:"",classes:{},classesCache:{},path:{},pathCache:{},loadErrorInfo:{},noop:function(){},$sojs:function(){var t={};if("undefined"!=typeof window&&window&&"undefined"!=typeof document&&document?(this.runtime="browser",t.global=window):(this.runtime="node",t.global=global),t.proxyName="proxy",t.path="node"===this.runtime?process.cwd()+"/src/":"/src/","undefined"!=typeof $sojs_config)for(var e in $sojs_config)e&&$sojs_config.hasOwnProperty(e)&&(t[e]=$sojs_config[e]);this.global=t.global,t.proxyName&&(Function.prototype[t.proxyName]=this.proxy),this.setPath(t.path),this.deepClone=this.deepClone.proxy(this),this.global.sojs=this.global.sojs||this},getPath:function(t){var e=!!t&&t.split("."),s=this.path;if(e)for(var i=0,n=e.length;i<n;i++){var r=e[i].toLowerCase();if(!s[r])break;s=s[r]}return s.pathValue},setPath:function(t,e){var s=this.path;if("object"!=typeof t){if(e)for(var i=t.split("."),n=0,r=i.length;n<r;n++){var a=i[n].toLowerCase();s[a]=s[a]||{pathValue:s.pathValue},s=s[a]}else e=t;s.pathValue=e,this.pathCache={}}else for(var o in t)o&&t.hasOwnProperty(o)&&this.setPath(o,t[o])},getClassPath:function(t,e){var s=this.pathCache[t];if(!s){var i=this.getPath(t),n=i.length-1;i.lastIndexOf("\\")!==n&&i.lastIndexOf("/")!==n&&(i+="/"),s=i+t.replace(/\./gi,"/")+".js",this.pathCache[t]=s}return e&&(s=s.replace(".js","")),s},loadDeps:function(t,e){e=e||{};var s=t.__deps,i=(t.__namespace,[]);for(var n in s)if(s.hasOwnProperty(n)&&s[n]){var r;if("string"!=typeof s[n]?(t[n]=s[n],t[n]&&t[n].__name&&(r=t[n].__full)):(r=s[n],t[n]=this.find(r)),!r||e[r])continue;if(e[r]=!0,t[n])t[n].__deps&&(i=i.concat(this.loadDeps(t[n],e)));else{if("node"===this.runtime)try{t[n]=require(this.getClassPath(r))}catch(t){this.loadErrorInfo[r]=t.stack.toString()}t[n]||i.push(r)}}return i},fastClone:function(t){var e=function(){};return e.prototype=t,new e},deepClone:function(t,e){"number"!=typeof e&&(e=5);var s,i=e-1;if(e>0)if(t instanceof Date)s=new Date,s.setTime(t.getTime());else if(t instanceof Array){s=[];for(var n=0,r=t.length;n<r;n++)s[n]=this.deepClone(t[n],i)}else if("object"==typeof t){s={};for(var a in t)if(t.hasOwnProperty(a)){var o=t[a];s[a]=this.deepClone(o,i)}}else s=t;else s=t;return s},proxy:function(t,e){var s=Array.prototype.slice.apply(arguments),i=s.shift(),n="function"==typeof this?this:s.shift();return function(){var t=Array.prototype.slice.apply(arguments);return n.apply(i,t.concat(s))}},find:function(t){var e=this.classesCache[t];if(!e){var s=t.split(".");e=this.classes[s[0]];for(var i=1,n=s.length;i<n;i++){if(!e||!e[s[i]]){e=null;break}e=e[s[i]]}}return e},reload:function(t){var e=this.find(t);if(e)if(e.__status=2,"node"===this.runtime){var s=this.getClassPath(t);delete require.cache[require.resolve(s)],e=require(s)}else e=this.define(e);else e=this.using(t);return e},create:function(t,e,s,i,n,r){return"string"==typeof t&&(t=this.using(t)),new t.__constructor(e,s,i,n,r)},using:function(t){var e=this.find(t);if("node"===this.runtime){if(e){if(!e.__status||1===e.__status)try{require(this.getClassPath(t))}catch(t){e.__status=2}}else try{require(this.getClassPath(t))}catch(t){throw t}e=this.find(t)}return e},define:function(t){var e,s=t.namespace;if("node"===this.runtime&&(void 0===t.name||void 0===t.namespace)){var i=arguments.callee.caller.arguments[4],n=arguments.callee.caller.arguments[3];!t.name&&i&&n&&(t.name=n.substring(i.length+1,n.length-3)),!t.namespace&&i&&(t.namespace=i.substring(i.indexOf("src")+4).replace(/\//gi,".").replace(/\\/gi,"."))}e=t.name||"__tempName",s=t.namespace||"",t.__name=e,t.__namespace=s,t.__full=s.length>1?s+"."+e:e,t.__deps=t.deps,t.__deepClone=this.deepClone,t.__status=2,t.__constructor=function(t,e,s,i,n){if(this.__clones&&this.__clones.length>0)for(var r=0,a=this.__clones.length;r<a;r++){var o=this.__clones[r];this[o]=this.__deepClone(this[o])}this.__constructorSource(t,e,s,i,n)},t.__constructorSource=t[e]||this.noop,t.__staticSource=t["$"+e]||this.noop,t.__staticUpdate=function(){var e=[];for(var s in this)if(this.hasOwnProperty(s)){var i=this[s];"object"!=typeof i||null===i||"deps"===s||0===s.indexOf("__")||t.__deps&&t.__deps[s]||e.push(s)}this.__clones=e,this.__constructor.prototype=this},t.__static=function(){this.__staticSource(),this.__staticUpdate()};for(var r,a=s.split("."),o=a.length,l=this.classes,c=0;c<o;c++)(r=a[c])&&(l[r]=l[r]||{__status:1},l=l[r]);l[e]=l[e]||{};var h=l;if(l=l[e],l.__name&&3===l.__status)t=l;else{if(!l.__status||1===l.__status)for(var u in h[e])u&&h[e].hasOwnProperty(u)&&(t[u]=h[e][u]);t.__status=3,h[e]=t,t=h[e];var f=this.loadDeps(t);if(f.length>0){if(this.loader=this.loader||this.using("sojs.loader"),"browser"!==this.runtime||!this.loader){for(var p='class "'+t.name+'" load deps error\n',c=0;c<f.length;c++)p+="["+f[c]+"]:"+this.loadErrorInfo[f[c]]+"\n";throw new Error(p)}this.loader.loadDepsBrowser(t,f)}else t.__static()}return"node"===this.runtime&&arguments.callee.caller.arguments[2]&&(arguments.callee.caller.arguments[2].exports=t),this.classesCache[t.__full]=t,t}};t.define(t)}(),sojs.define({name:"event",namespace:"sojs",eventList:null,groupList:null,$event:function(){},event:function(){this.eventList={},this.groupList={},this.eventGroupIndexer={}},createCallback:function(t,e){return t=t,e=void 0!==e?e:-1,{callback:t,data:null,needTimes:e,emitTimes:0}},createEvent:function(t){return{name:t,callbacks:[],callbackData:[],emitData:[],status:!1,groups:{}}},createGroup:function(t){return{name:t,callbacks:[],callbackData:[],emitData:[],status:!1,events:{},previousGroups:{},afterGroups:{}}},bind:function(t,e,s){var i=this.eventList[t]=this.eventList[t]||this.createEvent(t);if(i.callbacks.push(this.createCallback(e,s)),i.status&&i.emitData.length){for(var n=0,r=i.emitData.length;n<r;n++)this.emit(i.name,i.emitData[n]);i.emitData=[]}return this},unbind:function(t,e){if(t||e){var s=this.eventList[t];if(s&&s.callbacks&&s.callbacks.length)for(var i=0,n=s.callbacks.length;i<n;i++)e?s.callbacks[i].callback===e&&(s.callbacks[i].callback=null,s.callbacks[i].needTimes=0):(s.callbacks[i].callback=null,s.callbacks[i].needTimes=0)}else for(var r in this.eventList)r&&this.eventList[r]&&this.eventList.hasOwnProperty(r)&&this.unbind(r)},emit:function(t,e){var s=this.eventList[t]=this.eventList[t]||this.createEvent(t);if(s.status=!0,s.callbacks&&s.callbacks.length){if(s.callbacks&&s.callbacks.length)for(var i=0,n=s.callbacks.length;i<n;i++){var r=s.callbacks[i],a=r.callback,o=!1;-1===r.needTimes?o=!0:r.needTimes>0&&r.emitTimes<r.needTimes&&(o=!0),r.emitTimes++,o&&a&&(r.data=a(e))}}else s.emitData.push(e);for(var l in s.groups)l&&s.groups.hasOwnProperty(l)&&s.groups[l]&&this.groupEmit(l);return this},group:function(t,e,s,i){var n=this.groupList[t]=this.groupList[t]||this.createGroup(t);if(s){s=s instanceof Array?s:[s];for(var r=0,a=s.length;r<a;r++)n.callbacks.push(this.createCallback(s[r],i))}var o;e="string"==typeof e?[e]:e;for(var r=0,a=e.length;r<a;r++)if(o=e[r],!n.events[o]){n.status=!1;var l=this.eventList[o]=this.eventList[o]||this.createEvent(o);l.groups[t]=1,n.events[o]=1}return e.length>0&&this.groupEmit(t),this},groupEmit:function(t){var e=this.groupList[t]=this.groupList[t]||this.createGroup(t),s=e.afterGroups,i=!0;for(var n in s)n&&s.hasOwnProperty(n)&&this.groupList[n]&&(this.groupList[n].status||(i=!1));if(!i)return this;var r,a=e.events,o=!0;for(var l in a)if(l&&a.hasOwnProperty(l)&&a[l]&&(r=this.eventList[l]=this.eventList[l]||this.createEvent(l),!r.status)){o=!1;break}if(o){e.status=!0;var c={};for(var l in a)if(l&&a.hasOwnProperty(l)&&a[l]){var h=this.eventList[l].callbacks;c[l]=[];for(var u=0,f=h.length;u<f;u++)c[l].push(h[u].data);1===c[l].length&&(c[l]=c[l][0])}if(e.callbacks&&e.callbacks.length)for(var u=0,f=e.callbacks.length;u<f;u++){var p=e.callbacks[u],v=p.callback,d=!1;-1===p.needTimes?d=!0:p.needTimes>0&&p.emitTimes<p.needTimes&&(d=!0),p.emitTimes++,d&&v&&(p.data=v(c))}var g=e.previousGroups;for(var m in g)m&&g.hasOwnProperty(m)&&this.groupEmit(m)}return this},queue:function(t,e){for(var s,i,n=Array.prototype.slice.apply(arguments),r=1,a=n.length;r<a;r++){s=n[r-1],i=n[r],s=s instanceof Array?s:[s],i=i instanceof Array?i:[i];for(var o=0,l=s.length;o<l;o++){var t=s[o];this.groupList[t]=this.groupList[t]||this.createGroup(t);for(var c=this.groupList[t],h=0,u=i.length;h<u;h++){var e=i[h];this.groupList[e]=this.groupList[e]||this.createGroup(e);var f=this.groupList[e];c.afterGroups[e]=1,f.previousGroups[t]=1}}}}}),sojs.define({name:"promise",namespace:"sojs",deps:{event:"sojs.event"},promise:function(t){if(this.ev=sojs.create(this.event),t)try{t(sojs.proxy(this,this.getResolve),sojs.proxy(this,this.getReject))}catch(t){this.getReject(t)}},status:"pending",data:null,ev:null,defaultFunc:function(t){return t},getResolve:function(t){if(t&&"function"==typeof t.then){var e=t,s=sojs.proxy(this,function(t){this.getResolve(t)}),i=sojs.proxy(this,function(t){this.getReject(t)});e.then(s,i)}else if(this.status="fulfilled",this.data=t,this.ev.eventList&&this.ev.eventList.onRejected)try{this.ev.emit("onFulfilled",t)}catch(t){this.getReject(t)}},resolve:function(t){var e=sojs.create(this);return e.getResolve(t),e},getReject:function(t){return this.status="rejected",this.data=t,this.ev.eventList&&this.ev.eventList.onRejected&&this.ev.emit("onRejected",t),t},reject:function(t){var e=sojs.create(this);return e.getReject(t),e},promisify:function(t,e){return function(){var s=sojs.create("sojs.promise"),i=Array.prototype.slice.apply(arguments),n=function(t){if(t)this.getReject(t);else{var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),this.getResolve(e)}};return i.push(sojs.proxy(s,n)),t.apply(e,i),s}},then:function(t,e){t=t||this.defaultFunc,e=e||this.defaultFunc;var s=sojs.create("sojs.promise"),i=sojs.proxy(s,function(t){this.getResolve(t.onFulfilled)}),n=sojs.proxy(s,function(t){this.getReject(t.onRejected)});return this.ev.bind("onFulfilled",t),this.ev.group("onFulfilledGroup","onFulfilled",i),this.ev.bind("onRejected",e),this.ev.group("onRejectedGroup","onRejected",n),"fulfilled"===this.status?setTimeout(sojs.proxy(this,function(){this.getResolve(this.data)}),0):"rejected"===this.status&&setTimeout(sojs.proxy(this,function(){this.getReject(this.data)}),0),s},catch:function(t){return this.then(null,t)},all:function(t){var e=sojs.create(this),s=sojs.create("sojs.event");s.bind("error",sojs.proxy(e,function(t){this.getReject(t)}));for(var i=[],n=0,r=t.length;n<r;n++){var a="event-"+(n+1);i.push(a);var o=t[n];o.__eventName=a,o.allEvent=s,s.bind(a,function(t){return t});var l=function(t){this.allEvent.emit(this.__eventName,t)}.proxy(o),c=function(t){this.allEvent.emit("error",t),this.allEvent.unbind()}.proxy(o);o.then(l,c)}return s.group("all",i,function(t){var e=[];for(var s in t)e.push(t[s]);this.getResolve(e)}.proxy(e)),e},race:function(t){var e=sojs.create(this),s=sojs.create("sojs.event");s.bind("success",sojs.proxy(e,function(t){this.getResolve(t)})),s.bind("error",sojs.proxy(e,function(t){this.getReject(t)}));for(var i=[],n=0,r=t.length;n<r;n++){var a="event-"+(n+1);i.push(a);var o=t[n],l=function(t){this.emit("success",t),this.unbind()}.proxy(s),c=function(t){this.emit("error",t),this.unbind()}.proxy(s);o.then(l,c)}return e}}),sojs.define({name:"loader",namespace:"sojs",deps:{event:"sojs.event"},$loader:function(){this.ev=sojs.create(this.event)},loadScript:function(t,e,s){if("function"==typeof e&&(s=e,e="1.0.0"),e=e||"1.0.0",e&&(t+="?v="+e),s=s||function(){},this.loading=this.loading||{},!this.loading[t]){this.loading[t]=1;var i=document.createElement("script");i.type="text/javascript",i.async=!0,i.src=t,i.onload=i.onerror=i.onreadystatechange=function(t){/loaded|complete|undefined/.test(i.readyState)&&(i.onload=i.onerror=i.onreadystatechange=null,i=void 0,s())};var n=document.getElementsByTagName("script")[0];return n.parentNode.insertBefore(i,n),this}},loadDepsBrowser:function(t,e){var s=t.__full;this.ev.groupList[s]||this.ev.group(s,[],function(){sojs.reload(s)});for(var i=0,n=e.length;i<n;i++){var r=e[i];this.ev.eventList[r]||this.ev.bind(r,function(){return!0}),this.ev.group(s,r),this.ev.groupList[r]||(this.ev.group(r,[],function(t,e){sojs.reload(e)}.proxy(this,r)),this.ev.groupList[r].status=!0),this.ev.queue(s,r);var a=sojs.getClassPath(r),o=sojs.proxy(this,function(t){this.ev.emit(t,t)},r);this.loadScript(a,o)}return this}});